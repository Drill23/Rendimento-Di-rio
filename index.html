<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">
    <title>Calc. Rendimento Aves</title>
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' style='background:%23121212'%3E%3Cpath d='M448 96L288 256 192 160 32 320' fill='none' stroke='%2300f2ff' stroke-width='32' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --input-bg: #2c2c2c;
            --text: #ffffff;
            --text-muted: #a0a0a0;
            --accent: #00f2ff;
            --success: #00e676; /* Verde Neon */
            --danger: #ff1744;  /* Vermelho Neon */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Inter', sans-serif;
            margin: 0; padding: 20px;
            padding-top: env(safe-area-inset-top);
            padding-bottom: 50px;
        }

        h1 {
            text-align: center; font-size: 1.4rem; margin-bottom: 20px;
            color: var(--accent); text-transform: uppercase; letter-spacing: 1px;
        }

        /* CARD DE CONTROLE GERAL */
        .control-panel {
            background: var(--card); padding: 20px; border-radius: 16px;
            border: 1px solid #333; margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            position: sticky; top: 10px; z-index: 100; /* Fica fixo no topo ao rolar */
        }

        .input-label {
            font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase;
            letter-spacing: 0.5px; margin-bottom: 8px; display: block;
        }

        .big-input {
            width: 100%; background: var(--input-bg); border: 2px solid #333;
            color: var(--accent); font-size: 1.8rem; font-weight: 700;
            padding: 10px; border-radius: 10px; text-align: center; outline: none;
            transition: 0.3s;
        }
        .big-input:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }

        /* LISTA DE ITENS */
        .items-grid { display: flex; flex-direction: column; gap: 15px; }

        .item-card {
            background: var(--card); border-radius: 12px; padding: 15px;
            border-left: 5px solid #444; transition: 0.3s;
        }
        .item-card.profit { border-left-color: var(--success); background: linear-gradient(90deg, rgba(0,230,118,0.05) 0%, var(--card) 100%); }
        .item-card.loss { border-left-color: var(--danger); background: linear-gradient(90deg, rgba(255,23,68,0.05) 0%, var(--card) 100%); }

        .item-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
        }
        .item-title { font-size: 1.1rem; font-weight: 700; }
        
        /* INPUTS DO ITEM */
        .inputs-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .small-input-group label { font-size: 0.7rem; color: var(--text-muted); display: block; margin-bottom: 4px; }
        .small-input {
            width: 100%; background: var(--input-bg); border: 1px solid #333;
            color: #fff; padding: 8px; border-radius: 6px; font-size: 1rem; text-align: center;
        }
        .small-input:focus { border-color: #666; outline: none; }

        /* RESULTADOS */
        .results-area {
            background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .result-block { text-align: right; }
        .res-label { font-size: 0.75rem; color: var(--text-muted); }
        .res-value { font-size: 1.2rem; font-weight: 700; }
        
        .val-green { color: var(--success); }
        .val-red { color: var(--danger); }

        /* CAIXAS */
        .box-badge {
            background: #333; color: #fff; padding: 4px 8px;
            border-radius: 4px; font-size: 0.8rem; margin-top: 5px; display: inline-block;
        }

        .btn-reset {
            margin-top: 30px; width: 100%; padding: 15px;
            background: transparent; border: 1px solid #444; color: #666;
            border-radius: 8px; cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>Calculadora de Rendimento</h1>

    <div class="control-panel">
        <label class="input-label">PESO TOTAL DE ABATE (KG) DO DIA</label>
        <input type="number" id="total-weight" class="big-input" placeholder="00000" inputmode="numeric">
    </div>

    <div id="app-container" class="items-grid"></div>

    <button class="btn-reset" onclick="resetDay()">ZERAR DADOS DO DIA</button>

    <script>
        // CONFIGURAÇÃO INICIAL (Baseada no seu PDF)
        // O usuário pode editar a meta na tela e ela será salva.
        const defaultItems = [
            { id: 'coxa_sobre', name: 'COXA/SOBRECOXA', meta: 26.500 },
            { id: 'file', name: 'FILE', meta: 26.500 },
            { id: 'coxinha', name: 'COXINHA DA ASA', meta: 4.600 },
            { id: 'meio_asa', name: 'MEIO DA ASA', meta: 2.800 },
            { id: 'ponta_asa', name: 'PONTA DA ASA', meta: 0.930 },
            { id: 'figado', name: 'FIGADO', meta: 1.600 },
            { id: 'moela', name: 'MOELA', meta: 1.100 },
            { id: 'coracao', name: 'CORAÇÃO', meta: 0.480 },
            { id: 'pes', name: 'PÉS', meta: 2.850 },
            { id: 'cms', name: 'CMS', meta: 15.000 },
            { id: 'sambiquira', name: 'SAMBIQUIRA', meta: 0.800 },
            { id: 'dorso', name: 'DORSO', meta: 0.000 }
        ];

        // Carrega dados salvos ou usa o padrão
        let itemsData = JSON.parse(localStorage.getItem('rendimentoItems')) || defaultItems;
        // Adiciona campos de 'boxWeight' e 'realized' se não existirem
        itemsData = itemsData.map(i => ({
            ...i, 
            boxWeight: i.boxWeight || '', 
            realized: i.realized || '' 
        }));

        const container = document.getElementById('app-container');
        const totalWeightInput = document.getElementById('total-weight');

        // Carrega peso total salvo (opcional, bom pra não perder se fechar o app)
        totalWeightInput.value = localStorage.getItem('totalWeight') || '';

        function render() {
            container.innerHTML = '';
            itemsData.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'item-card';
                div.id = `card-${index}`;

                div.innerHTML = `
                    <div class="item-header">
                        <span class="item-title">${item.name}</span>
                    </div>

                    <div class="inputs-row">
                        <div class="small-input-group">
                            <label>META (%)</label>
                            <input type="number" class="small-input" value="${item.meta}" 
                                oninput="updateItem(${index}, 'meta', this.value)">
                        </div>
                        <div class="small-input-group">
                            <label style="color:var(--accent);">REALIZADO (%)</label>
                            <input type="number" class="small-input" style="border-color:var(--accent);" value="${item.realized}" placeholder="0.00"
                                oninput="updateItem(${index}, 'realized', this.value)">
                        </div>
                        <div class="small-input-group">
                            <label>PESO CX (KG)</label>
                            <input type="number" class="small-input" value="${item.boxWeight}" placeholder="kg"
                                oninput="updateItem(${index}, 'boxWeight', this.value)">
                        </div>
                    </div>

                    <div class="results-area">
                        <div>
                            <div class="res-label">Diferença %</div>
                            <div id="diff-perc-${index}" class="res-value">0.00%</div>
                        </div>
                        <div class="result-block">
                            <div class="res-label">Saldo (Kg)</div>
                            <div id="diff-kg-${index}" class="res-value">0.0 kg</div>
                            <div id="diff-box-${index}" class="box-badge">0 caixas</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
            calculateAll();
        }

        function updateItem(index, field, value) {
            itemsData[index][field] = value;
            save();
            calculateAll();
        }

        totalWeightInput.addEventListener('input', (e) => {
            localStorage.setItem('totalWeight', e.target.value);
            calculateAll();
        });

        function calculateAll() {
            const totalAbate = parseFloat(totalWeightInput.value) || 0;

            itemsData.forEach((item, index) => {
                const meta = parseFloat(item.meta) || 0;
                const realized = parseFloat(item.realized); // Pode ser NaN se vazio
                const boxW = parseFloat(item.boxWeight) || 0;

                const card = document.getElementById(`card-${index}`);
                const elPerc = document.getElementById(`diff-perc-${index}`);
                const elKg = document.getElementById(`diff-kg-${index}`);
                const elBox = document.getElementById(`diff-box-${index}`);

                // Se não tem realizado digitado, reseta visual
                if (isNaN(realized) || totalAbate === 0) {
                    elPerc.innerText = '---';
                    elKg.innerText = '---';
                    elBox.innerText = '---';
                    card.className = 'item-card'; // Neutro
                    return;
                }

                // CÁLCULOS
                // Lógica: Realizado - Meta = Diferença
                // Ex: Meta 26.5, Real 26.0 -> -0.5 (Faltou)
                const diffPerc = realized - meta;
                const diffKg = totalAbate * (diffPerc / 100);
                
                let diffBoxes = 0;
                if (boxW > 0) {
                    diffBoxes = diffKg / boxW;
                }

                // VISUAL
                const isPositive = diffPerc >= 0;
                
                // Formatação
                elPerc.innerText = (isPositive ? "+" : "") + diffPerc.toFixed(3) + "%";
                elKg.innerText = diffKg.toFixed(1) + " kg";
                
                // Caixas
                if (boxW > 0) {
                    elBox.innerText = diffBoxes.toFixed(1) + " cx";
                    elBox.style.display = 'inline-block';
                } else {
                    elBox.style.display = 'none';
                }

                // Cores
                elPerc.className = `res-value ${isPositive ? 'val-green' : 'val-red'}`;
                elKg.className = `res-value ${isPositive ? 'val-green' : 'val-red'}`;
                
                // Borda do Card
                card.className = `item-card ${isPositive ? 'profit' : 'loss'}`;
                
                // Texto auxiliar
                if(!isPositive) {
                    elKg.innerText = `Faltou: ${Math.abs(diffKg).toFixed(1)} kg`;
                } else {
                    elKg.innerText = `Sobrou: ${diffKg.toFixed(1)} kg`;
                }
            });
        }

        function save() {
            localStorage.setItem('rendimentoItems', JSON.stringify(itemsData));
        }

        function resetDay() {
            if(confirm("Deseja limpar os valores 'Realizado' de hoje? As metas e pesos de caixa serão mantidos.")) {
                itemsData = itemsData.map(i => ({ ...i, realized: '' }));
                totalWeightInput.value = '';
                localStorage.setItem('totalWeight', '');
                save();
                render();
            }
        }

        // Inicia
        render();

    </script>
</body>
</html>
